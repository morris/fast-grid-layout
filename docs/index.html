<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Fast Grid Layout</title>
    <meta
      name="description"
      content="Fast editable grid layout system similar to React Grid Layout. Performant even at hundreds of items. Vanilla/framework-agnostic."
    />

    <link rel="stylesheet" href="./css/fast-grid-layout.css" />
    <link rel="stylesheet" href="./css/demo.css" />
  </head>
  <body>
    <div class="demo-column">
      <h1>Fast Grid Layout</h1>

      <nav>
        <p>
          Demos:
          <strong>Vanilla</strong> |
          <a href="./responsive.html">Responsive Breakpoints</a> |
          <a href="./react.html">React</a>
        </p>
      </nav>

      <p>
        <label>
          Number of items
          <select name="numberOfItems">
            <option selected>10</option>
            <option>50</option>
            <option>100</option>
            <option>500</option>
            <option>1000</option>
          </select>
        </label>
      </p>

      <div class="demo-container">
        <div class="fast-grid-layout"></div>
      </div>
    </div>

    <script type="module">
      import { GridLayout } from './js/fast-grid-layout.js';
      import { generateDemoLayout } from './js/demo.js';
      import { reconcile } from 'https://cdn.jsdelivr.net/npm/exdom@2/dist/exdom.min.js';

      const container = document.querySelector('.fast-grid-layout');
      const columns = 12;

      let layout = [];

      const gridLayout = new GridLayout(container, {
        columns,
        rowHeight: 40,
        gap: 10,
      });

      gridLayout.setEditable(true);
      gridLayout.onLayoutChange((l) => {
        layout = l;
      });

      regenerate();

      document
        .querySelector('[name=numberOfItems]')
        .addEventListener('change', regenerate);

      document.addEventListener('click', (e) => {
        if (e.target.matches('.delete')) {
          delete_(e.target.parentNode.dataset.key);
        }
      });

      function delete_(key) {
        layout = layout.filter((item) => item.i !== key);

        update();
      }

      function regenerate() {
        const numberOfItems = parseInt(
          document.querySelector('[name=numberOfItems]').value,
        );

        layout = generateDemoLayout(numberOfItems, columns);

        update();
      }

      function update() {
        reconcile({
          container,
          items: layout,
          key: (item) => item.i,
          create(item) {
            const i = parseInt(item.i);
            const element = document.createElement('div');
            element.dataset.key = item.i;
            element.className = `demo-item -style${(i % 16) + 1}`;
            element.innerHTML = `<h2>${i + 101}</h2><button class="delete">&times;</button>`;

            if (i % 5 === 3) {
              element.innerHTML += '<p class="content">Example content</p>';
            }

            if (item.static) {
              element.innerHTML += '<p class="content">(Static item)</p>';
            }

            return element;
          },
        });

        gridLayout.setLayout(layout);
      }
    </script>
  </body>
</html>
